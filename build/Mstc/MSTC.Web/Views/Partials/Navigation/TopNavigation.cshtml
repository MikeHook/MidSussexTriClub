@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@using Umbraco.Web;

@{
    var site = Model.Content.Site();
    var selection = site.Children.Where(x => x.IsVisible());

    var homepage = Model.Content.AncestorOrSelf<Home>(1);
    var _memberProvider = new Mstc.Core.Providers.MemberProvider(ApplicationContext.Services);
    var currentUser = User.Identity.IsAuthenticated ? _memberProvider.GetLoggedInMember() : null;
}

@helper ChangePasswordLink(Home homepage)
{
    if (homepage.ChangePasswordPage != null)
    {
        <a href="@homepage.ChangePasswordPage.Url">Change password</a>
    }
}

@helper LogoutForm()
{
    using (Html.BeginUmbracoForm("SubmitLogout", "Member", System.Web.Mvc.FormMethod.Post, new { id = "logout" }))
    {
        @Html.AntiForgeryToken()
        <input class="btn-yellow" name="logout" type="submit" value="Log out" />    
    }
}

<div class="mainmenu-header">
    <div class="container">
        <div class="menuextras">
            <div class="extras">
                <div class="login-status">
                    @if (currentUser != null)
                    {
                        <p><em>Welcome back @currentUser.Name</em> @ChangePasswordLink(homepage) @LogoutForm()</p>
                    }
                </div>

                <ul>
                    <li class="active"><a href="@homepage.Url">Club Site</a> | </li>
                    <li><a href="https://midsussextriathlon.com/" target="_blank">The Mid Sussex Triathlon</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>